workflow:
  name: "Global Orchestrator"
  description: "Route to support or sales subflows"

  agents:
    - id: "router_agent"
      role: "Router"
      llm: "gpt-4"
      temperature: 0.0
      seed: 42

  tools:
    - name: "file_reader"
      description: "Read a file deterministically"
    - name: "api_caller"
      description: "Fetch structured data from a URL"
    - name: "url_validator"
      description: "Validate URL availability"
    - name: "file_writer"
      description: "Write a deterministic file output"
    - name: "sql_query"
      description: "Run a deterministic SQL query"
    - name: "email_sender"
      description: "Send notification email"
    - name: "slack_notifier"
      description: "Post a deterministic Slack notification"
    - name: "webhook_caller"
      description: "Invoke an outbound webhook"

  graph:
    nodes:
      - id: "start"
        type: "input"
      - id: "route"
        type: "condition"
        condition: "route_rule"
      - id: "support_subflow"
        type: "subgraph"
        workflow_id: "support_subflow"
      - id: "sales_subflow"
        type: "subgraph"
        workflow_id: "sales_subflow"
      - id: "fallback_subflow"
        type: "subgraph"
        workflow_id: "fallback_subflow"
      - id: "read_file"
        type: "tool"
        tool_name: "file_reader"
      - id: "fetch_url"
        type: "tool"
        tool_name: "api_caller"
      - id: "validate_url"
        type: "tool"
        tool_name: "url_validator"
      - id: "write_file"
        type: "tool"
        tool_name: "file_writer"
      - id: "query_db"
        type: "tool"
        tool_name: "sql_query"
      - id: "retry_checks"
        type: "loop"
        condition: "retry_needed"
        max_iterations: 2
      - id: "send_email"
        type: "tool"
        tool_name: "email_sender"
      - id: "notify_slack"
        type: "tool"
        tool_name: "slack_notifier"
      - id: "call_webhook"
        type: "tool"
        tool_name: "webhook_caller"
      - id: "post_route"
        type: "condition"
        condition: "post_action"
      - id: "archive_report"
        type: "tool"
        tool_name: "file_writer"
      - id: "escalate_ticket"
        type: "tool"
        tool_name: "email_sender"
      - id: "router"
        type: "agent"
        agent: "router_agent"
      - id: "end"
        type: "output"

    edges:
      - from: "start"
        to: "route"
      - from: "route"
        to: "support_subflow"
        condition: "route == 'support'"
      - from: "route"
        to: "sales_subflow"
        condition: "route == 'sales'"
      - from: "route"
        to: "fallback_subflow"
        condition: "route not in ['support', 'sales']"
      - from: "support_subflow"
        to: "read_file"
      - from: "sales_subflow"
        to: "read_file"
      - from: "fallback_subflow"
        to: "read_file"
      - from: "read_file"
        to: "fetch_url"
      - from: "fetch_url"
        to: "validate_url"
      - from: "validate_url"
        to: "write_file"
      - from: "write_file"
        to: "query_db"
      - from: "query_db"
        to: "retry_checks"
      - from: "retry_checks"
        to: "query_db"
        condition: "retry_needed == true"
      - from: "retry_checks"
        to: "send_email"
      - from: "send_email"
        to: "notify_slack"
        parallel: true
      - from: "send_email"
        to: "call_webhook"
        parallel: true
      - from: "notify_slack"
        to: "router"
      - from: "call_webhook"
        to: "router"
      - from: "router"
        to: "post_route"
      - from: "post_route"
        to: "archive_report"
        condition: "post_action == 'archive'"
      - from: "post_route"
        to: "escalate_ticket"
        condition: "post_action == 'escalate'"
      - from: "archive_report"
        to: "end"
      - from: "escalate_ticket"
        to: "end"
      - from: "router"
        to: "end"